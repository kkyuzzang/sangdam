<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í•™ìƒ ê¸°ì´ˆ ìƒë‹´ ìë£Œ ê´€ë¦¬</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @media print {
            body { 
                margin: 0; 
                padding: 0; 
                font-size: 9pt; 
            }
            .no-print { display: none !important; }
            
            /* í•™ìƒë³„ ì¸ì‡„ ì»¨í…Œì´ë„ˆ: ë‚´ìš©ì´ ê¸¸ì–´ì§€ë©´ ìë™ìœ¼ë¡œ ë‹¤ìŒ í˜ì´ì§€ë¡œ ë„˜ì–´ê° */
            .print-container { 
                width: 210mm;
                margin: 0;
                padding: 10mm 8mm; /* ì¸ì‡„ ì—¬ë°± (ìƒí•˜ë¥¼ ì¡°ê¸ˆ ë” ì¤Œ) */
                box-sizing: border-box;
                /* ê° í•™ìƒ ìë£ŒëŠ” ìƒˆ í˜ì´ì§€ì—ì„œ ì‹œì‘ */
                page-break-before: always; 
            }
            /* ì²« ë²ˆì§¸ í•™ìƒ ìë£Œ ì•ì—ëŠ” í˜ì´ì§€ êµ¬ë¶„í•˜ì§€ ì•ŠìŒ */
            .print-container:first-of-type {
                page-break-before: auto;
            }
            /* ë‚´ìš©ì´ ê¸¸ì–´ì ¸ í˜ì´ì§€ê°€ ë‚˜ë‰  ê²½ìš°, í‘œê°€ ì˜ë¦¬ì§€ ì•Šë„ë¡ ëŒ€ë¹„ */
            .break-inside-avoid {
                break-inside: avoid;
            }

            /* ì¸ì‡„ ì‹œ ë°°ê²½ìƒ‰ ê°•ì œ ì¶œë ¥ */
            * {
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
                color-adjust: exact !important;
            }
            
            /* ì„¸ë¶€ ì •ë³´ë¥¼ ìœ„í•œ í°íŠ¸ í¬ê¸° ì¡°ì • (ê¸°ë³¸ 9pt) */
            .text-xs, .text-sm { font-size: 9pt !important; } 
            
            /* ì¸ì‡„ ì‹œ í…Œì´ë¸” ì¤„ ê°„ê²© ì¤„ì´ê¸° */
            .grid-cols-5 > div {
                padding-top: 0.5px;
                padding-bottom: 0.5px;
            }
            .prose-sm { font-size: 9pt !important; }

            /* ì¸ì‡„ ì‹œ ì¹´ë“œ ê·¸ë¦¼ì ì œê±° */
            .shadow-lg { box-shadow: none !important; }
        }
        @page {
            size: A4;
            margin: 0;
        }
        .ai-analysis {
            animation: fadeIn 0.5s;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>
</head>
<body class="bg-gray-100">
    <div id="app"></div>

    <script>
        let students = [];
        let selectedStudent = null;
        let currentPage = 'list';
        let searchTerm = '';
        let apiKey = localStorage.getItem('geminiApiKey') || '';
        let aiAnalysis = {};

        function render() {
            const app = document.getElementById('app');
            
            if (currentPage === 'list') {
                app.innerHTML = renderListPage();
            } else if (currentPage === 'detail') {
                app.innerHTML = renderDetailPage();
            } else if (currentPage === 'printAll') {
                app.innerHTML = renderPrintAllPage();
            }
            
            attachEventListeners();
        }

        function renderListPage() {
            const filteredStudents = students.filter(student =>
                student.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                student.studentId.includes(searchTerm)
            );

            return `
                <div class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-6 flex flex-col">
                    <div class="max-w-4xl mx-auto flex-grow w-full">
                        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                            <h1 class="text-3xl font-bold text-indigo-700 mb-2 flex items-center gap-2">
                                ğŸ“„ í•™ìƒ ê¸°ì´ˆ ìƒë‹´ ìë£Œ ê´€ë¦¬
                            </h1>
                            <p class="text-gray-600 mb-4">êµ¬ê¸€ ì„¤ë¬¸ì§€ ê²°ê³¼ ì—‘ì…€ íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì—¬ í•™ìƒ ì •ë³´ë¥¼ í™•ì¸í•˜ì„¸ìš”.</p>
                            
                            <!-- ì‚¬ìš© ë°©ë²• ì•ˆë‚´ -->
                            <div class="bg-blue-50 border border-blue-200 p-4 rounded-lg mb-4 text-sm text-gray-700">
                                <h3 class="font-bold text-blue-800 mb-2">ğŸ“Œ í”„ë¡œê·¸ë¨ ì‚¬ìš© ë°©ë²•</h3>
                                <ol class="list-decimal list-inside space-y-1">
                                    <li><span class="font-semibold">ì„¤ë¬¸ì§€ ë³µì‚¬:</span> 'êµ¬ê¸€ ì„¤ë¬¸ì§€ ì–‘ì‹ ë³µì‚¬í•˜ê¸°' ë²„íŠ¼ì„ ëˆŒëŸ¬ ì„¤ë¬¸ì§€ ì‚¬ë³¸ì„ ë§Œë“œì„¸ìš”.</li>
                                    <li><span class="font-semibold">ì„¤ë¬¸ ì‹¤ì‹œ:</span> í•™ìƒë“¤ì—ê²Œ ì„¤ë¬¸ì„ ì‹¤ì‹œí•˜ê³  ì‘ë‹µì„ ìˆ˜ì§‘í•©ë‹ˆë‹¤.</li>
                                    <li><span class="font-semibold">ì—‘ì…€ ë‹¤ìš´ë¡œë“œ:</span> êµ¬ê¸€ ì„¤ë¬¸ì§€ 'ì‘ë‹µ' íƒ­ì—ì„œ ì‘ë‹µ ë°ì´í„°ë¥¼ ì—‘ì…€ë¡œ ë‹¤ìš´ë¡œë“œí•©ë‹ˆë‹¤.</li>
                                    <li><span class="font-semibold">íŒŒì¼ ì—…ë¡œë“œ:</span> 'ì—‘ì…€ íŒŒì¼ ì—…ë¡œë“œ' ë²„íŠ¼ì„ ëˆŒëŸ¬ ë‹¤ìš´ë¡œë“œí•œ ì—‘ì…€ íŒŒì¼ì„ ì—…ë¡œë“œí•©ë‹ˆë‹¤.</li>
                                    <li><span class="font-semibold">í•™ìƒë³„ ì„¤ë¬¸ ë‚´ìš© í™•ì¸/ì¶œë ¥:</span> ëª©ë¡ì—ì„œ í•™ìƒì„ ì„ íƒí•˜ì—¬ ìƒì„¸ ë‚´ìš©ì„ í™•ì¸/ì¶œë ¥í•˜ê³  ì‰½ê³  í¸í•˜ê²Œ ìƒë‹´ì„ ì§„í–‰í•˜ì„¸ìš”.</li>
                                    <li><span class="font-semibold">AI ë¶„ì„ (ì„ íƒ):</span> API í‚¤ë¥¼ ì €ì¥í•œ í›„, í•™ìƒ ìƒì„¸ í™”ë©´ì—ì„œ AI ë¶„ì„ì„ ìš”ì²­í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
                                </ol>
                            </div>

                            <div class="flex items-center gap-4 flex-wrap mb-4">
                                <a 
                                    href="https://docs.google.com/forms/d/1Fg3cVdWzbY2BdpUCg1cRY5Z6J-RjR1_LezeFJdZtM38/copy" 
                                    target="_blank" 
                                    class="flex items-center gap-2 px-4 py-2 bg-yellow-500 text-white rounded-lg hover:bg-yellow-600 cursor-pointer transition"
                                >
                                    ğŸ”— êµ¬ê¸€ ì„¤ë¬¸ì§€ ì–‘ì‹ ë³µì‚¬í•˜ê¸°
                                </a>
                                <label class="flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 cursor-pointer transition">
                                    ğŸ“¤ ì—‘ì…€ íŒŒì¼ ì—…ë¡œë“œ
                                    <input type="file" accept=".xlsx,.xls" id="fileInput" class="hidden">
                                </label>
                                ${students.length > 0 ? `
                                    <button id="printAllBtn" class="flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition">
                                        ğŸ–¨ï¸ ì „ì²´ í•™ìƒ ìë£Œ ì¶œë ¥
                                    </button>
                                    <span class="text-gray-600">ì´ ${students.length}ëª…ì˜ í•™ìƒ ë°ì´í„°</span>
                                ` : ''}
                            </div>

                            <!-- API í‚¤ ì„¤ì • -->
                            <div class="border-t pt-4">
                                <div class="flex items-center gap-2 mb-2">
                                    <h3 class="font-bold text-gray-700">ğŸ¤– AI ë¶„ì„ ì„¤ì • (ì„ íƒì‚¬í•­)</h3>
                                    <span class="text-xs text-gray-500">Google Gemini API</span>
                                </div>
                                <div class="flex gap-2">
                                    <input
                                        type="password"
                                        id="apiKeyInput"
                                        placeholder="Google Gemini API í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”"
                                        value="${apiKey}"
                                        class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 text-sm"
                                    />
                                    <button id="saveApiKeyBtn" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition text-sm">
                                        ì €ì¥
                                    </button>
                                </div>
                                <p class="text-xs text-gray-500 mt-1">
                                    API í‚¤ë¥¼ ì„¤ì •í•˜ë©´ ê° í•™ìƒì˜ ìƒë‹´ ìë£Œë¥¼ AIê°€ ë¶„ì„í•˜ì—¬ êµìœ¡ì  ì¡°ì–¸ì„ ì œê³µí•©ë‹ˆë‹¤. 
                                    <a href="https://aistudio.google.com/app/apikey" target="_blank" class="text-indigo-600 underline">API í‚¤ ë°œê¸‰ë°›ê¸°</a>
                                </p>
                            </div>

                            <div id="error" class="hidden mt-4 p-3 bg-red-50 border border-red-200 rounded text-red-700"></div>
                        </div>

                        ${students.length > 0 ? `
                            <div class="bg-white rounded-lg shadow-lg p-6">
                                <div class="mb-4">
                                    <div class="relative">
                                        <span class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400">ğŸ”</span>
                                        <input
                                            type="text"
                                            placeholder="ì´ë¦„ ë˜ëŠ” í•™ë²ˆ ê²€ìƒ‰..."
                                            id="searchInput"
                                            value="${searchTerm}"
                                            class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                        />
                                    </div>
                                </div>

                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
                                    ${filteredStudents.map(student => `
                                        <button
                                            class="student-card p-4 rounded-lg bg-gray-50 hover:bg-indigo-50 border-2 border-transparent hover:border-indigo-300 transition text-left"
                                            data-id="${student.id}"
                                        >
                                            <div class="flex items-center gap-3">
                                                <span class="text-4xl">ğŸ‘¤</span>
                                                <div>
                                                    <div class="font-bold text-gray-800 text-lg">${student.name}</div>
                                                    <div class="text-sm text-gray-600">${student.studentId}</div>
                                                </div>
                                            </div>
                                        </button>
                                    `).join('')}
                                </div>
                            </div>
                        ` : ''}
                    </div>

                    <!-- ê°œë°œì ì •ë³´ í‘¸í„° -->
                    <footer class="mt-8 text-center text-gray-500 text-sm">
                        <p>ë§Œë“  ì‚¬ëŒ : ê²½ê¸°ë„ ì§€êµ¬ê³¼í•™ êµì‚¬ ë€¨ì§± ì´ìœ¤ê·œ</p>
                        <p>
                            <span>ë¬¸ì˜ : </span>
                            <a href="https://open.kakao.com/o/s7hVU65h" target="_blank" class="text-indigo-600 hover:text-indigo-800 underline transition">
                                ê°œë°œì ì˜¤í”ˆì±„íŒ…ìœ¼ë¡œ ì—°ë½í•˜ê¸°
                            </a>
                        </p>
                    </footer>
                </div>
            `;
        }

        function renderDetailPage() {
            if (!selectedStudent) return '';

            const analysis = aiAnalysis[selectedStudent.id];

            return `
                <div class="min-h-screen bg-gray-100">
                    <div class="no-print bg-white shadow-md p-4 mb-4">
                        <div class="max-w-4xl mx-auto flex items-center justify-between">
                            <button id="backBtn" class="flex items-center gap-2 px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition">
                                â† ëª©ë¡ìœ¼ë¡œ
                            </button>
                            <div class="flex gap-2">
                                ${apiKey ? `
                                    <button id="analyzeBtn" class="flex items-center gap-2 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition" ${analysis?.loading ? 'disabled' : ''}>
                                        ${analysis?.loading ? 'â³ ë¶„ì„ ì¤‘...' : 'ğŸ¤– AI ë¶„ì„'}
                                    </button>
                                ` : ''}
                                <button id="printBtn" class="flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition">
                                    ğŸ–¨ï¸ ì¸ì‡„í•˜ê¸°
                                </button>
                            </div>
                        </div>
                    </div>

                    ${analysis?.content ? `
                        <!-- AI ë¶„ì„ ì˜ì—­ (í™”ë©´ í‘œì‹œìš© - ì¸ì‡„ ì‹œ ìˆ¨ê¹€) -->
                        <div class="no-print max-w-4xl mx-auto mb-4">
                            <div class="bg-white rounded-lg shadow-lg p-6 ai-analysis border-l-4 border-purple-500">
                                <h2 class="text-xl font-bold text-purple-700 mb-3 flex items-center gap-2">
                                    ğŸ¤– AI êµìœ¡ ìƒë‹´ ë¶„ì„ (ì¢…í•© ì˜ê²¬)
                                </h2>
                                <div class="prose prose-sm max-w-none text-gray-700 whitespace-pre-wrap">${analysis.content}</div>
                            </div>
                        </div>
                    ` : ''}

                    ${renderStudentDetail(selectedStudent, analysis?.content)}
                    
                    <!-- ê°œë°œì ì •ë³´ í‘¸í„° (ìƒì„¸ í˜ì´ì§€ì—ì„œëŠ” ìˆ¨ê¹€) -->
                    <footer class="no-print mt-8 text-center text-gray-500 text-sm max-w-4xl mx-auto pb-4">
                        <p>ë§Œë“  ì‚¬ëŒ : ê²½ê¸°ë„ ì§€êµ¬ê³¼í•™ êµì‚¬ ë€¨ì§± ì´ìœ¤ê·œ</p>
                        <p>
                            <span>ë¬¸ì˜ : </span>
                            <a href="https://open.kakao.com/o/s7hVU65h" target="_blank" class="text-indigo-600 hover:text-indigo-800 underline transition">
                                ê°œë°œì ì˜¤í”ˆì±„íŒ…ìœ¼ë¡œ ì—°ë½í•˜ê¸°
                            </a>
                        </p>
                    </footer>
                </div>
            `;
        }

        function renderPrintAllPage() {
            return `
                <div class="min-h-screen bg-gray-100">
                    <div class="no-print bg-white shadow-md p-4 mb-4">
                        <div class="max-w-4xl mx-auto flex items-center justify-between">
                            <button id="backBtn" class="flex items-center gap-2 px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition">
                                â† ëª©ë¡ìœ¼ë¡œ
                            </button>
                            <button id="printBtn" class="flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition">
                                ğŸ–¨ï¸ ì „ì²´ ì¸ì‡„í•˜ê¸° (${students.length}ëª…)
                            </button>
                        </div>
                    </div>

                    ${students.map(student => {
                        const analysis = aiAnalysis[student.id];
                        // printAll ëª¨ë“œì—ì„œëŠ” AI ë¶„ì„ ë‚´ìš©ì„ ì¶œë ¥í•˜ì§€ë§Œ, ì¸ì‡„ ì‹œì—ëŠ” ìˆ¨ê²¨ì§€ë„ë¡ ì„¤ì •
                        return renderStudentDetail(student, analysis?.content); 
                    }).join('')}
                    
                    <!-- ê°œë°œì ì •ë³´ í‘¸í„° (ì¸ì‡„ ì „ì²´ ëª©ë¡ í˜ì´ì§€ì—ì„œëŠ” ìˆ¨ê¹€) -->
                    <footer class="no-print mt-8 text-center text-gray-500 text-sm max-w-4xl mx-auto pb-4">
                        <p>ë§Œë“  ì‚¬ëŒ : ê²½ê¸°ë„ ì§€êµ¬ê³¼í•™ êµì‚¬ ë€¨ì§± ì´ìœ¤ê·œ</p>
                        <p>
                            <span>ë¬¸ì˜ : </span>
                            <a href="https://open.kakao.com/o/s7hVU65h" target="_blank" class="text-indigo-600 hover:text-indigo-800 underline transition">
                                ê°œë°œì ì˜¤í”ˆì±„íŒ…ìœ¼ë¡œ ì—°ë½í•˜ê¸°
                            </a>
                        </p>
                    </footer>
                </div>
            `;
        }

        function renderStudentDetail(student, aiContent = null) {
            // í•œ í•™ìƒì˜ ëª¨ë“  ë‚´ìš©ì„ í•˜ë‚˜ì˜ ì¸ì‡„ ì»¨í…Œì´ë„ˆì— ë‹´ì•„ ë‚´ìš©ì— ë”°ë¼ í˜ì´ì§€ê°€ ìœ ë™ì ìœ¼ë¡œ ë‚˜ë‰˜ë„ë¡ í•¨
            return `
                <div class="print-container max-w-4xl mx-auto bg-white shadow-lg mb-8">
                    <!-- í—¤ë”: ì œëª© í˜•ì‹ ë³€ê²½ ë° í•œ ì¤„ ì²˜ë¦¬ -->
                    <div class="border-b-4 border-indigo-600 pb-3 mb-4">
                        <h1 class="text-2xl font-bold text-center text-indigo-700 overflow-hidden whitespace-nowrap text-ellipsis">
                            í•™ìƒ ê¸°ì´ˆ ìƒë‹´ ìë£Œ : ${student.studentId} ${student.name}
                        </h1>
                    </div>

                    <!-- ì£¼ìš” ì •ë³´ 2ë‹¨ ë ˆì´ì•„ì›ƒ -->
                    <div class="grid grid-cols-2 gap-3 text-xs mb-4">
                        
                        <!-- ì™¼ìª½ ì—´ -->
                        <div class="space-y-2">
                            
                            <!-- ê¸°ë³¸ ì •ë³´ (break-inside-avoidë¡œ í˜ì´ì§€ ë¶„í•  ë°©ì§€) -->
                            <div class="border border-gray-300 p-2 break-inside-avoid">
                                <h3 class="font-bold text-sm bg-indigo-100 px-2 py-1 mb-1">ğŸ“ ê¸°ë³¸ ì •ë³´</h3>
                                ${renderInfoRow('ë³¸ì¸ ì—°ë½ì²˜', student.contact)}
                                ${renderInfoRow('ë“±í•˜êµ ë°©ë²•', student.commute)}
                                ${renderInfoRow('ë“±í•˜êµ ì‹œê°„', student.commuteTime)}
                            </div>

                            <!-- ë³´í˜¸ì ë° ê°€ì¡± ì •ë³´ (break-inside-avoidë¡œ í˜ì´ì§€ ë¶„í•  ë°©ì§€) -->
                            <div class="border border-gray-300 p-2 break-inside-avoid">
                                <h3 class="font-bold text-sm bg-indigo-100 px-2 py-1 mb-1">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ ë³´í˜¸ì ë° ê°€ì¡± ì •ë³´</h3>
                                ${renderInfoRow('ë³´í˜¸ì1 ì´ë¦„', student.guardian1Name)}
                                ${renderInfoRow('ë³´í˜¸ì1 ê´€ê³„', student.guardian1Relation)}
                                ${renderInfoRow('ë³´í˜¸ì1 ì—°ë½ì²˜', student.guardian1Phone)}
                                ${renderInfoRow('ë³´í˜¸ì2 ì´ë¦„', student.guardian2Name)}
                                ${renderInfoRow('ë³´í˜¸ì2 ê´€ê³„', student.guardian2Relation)}
                                ${renderInfoRow('ë³´í˜¸ì2 ì—°ë½ì²˜', student.guardian2Phone)}
                                ${(student.siblingName1 || student.siblingName2) ? 
                                    renderInfoRow('í˜•ì œìë§¤', 
                                        `${student.siblingName1 ? `${student.siblingName1}(${student.siblingId1})` : ''}${student.siblingName2 ? `, ${student.siblingName2}(${student.siblingId2})` : ''}`
                                    ) : ''
                                }
                                ${renderInfoRow('í•¨ê»˜ ìƒí™œí•˜ëŠ” ì‚¬ëŒ', student.familyMembers)}
                                ${renderInfoRow('ê°€ì¡± ì¹œë°€ë„', student.familyIntimacy)}
                                ${student.familyComment ? `
                                    <div class="mt-1 pt-1 border-t">
                                        <div class="font-semibold text-gray-700 mb-1">ê°€ì • ê´€ê³„ ì˜ê²¬</div>
                                        <div class="text-gray-600">${student.familyComment}</div>
                                    </div>
                                ` : ''}
                            </div>

                            <!-- ê²½ì œ ìƒí™© (break-inside-avoidë¡œ í˜ì´ì§€ ë¶„í•  ë°©ì§€) -->
                            <div class="border border-gray-300 p-2 break-inside-avoid">
                                <h3 class="font-bold text-sm bg-indigo-100 px-2 py-1 mb-1">ğŸ’° ê²½ì œ ìƒí™©</h3>
                                ${renderInfoRow('ì¥í•™ê¸ˆ í•„ìš”', student.scholarship)}
                                ${renderInfoRow('ì¥í•™ê¸ˆ ì´ìœ ', student.scholarshipReason)}
                                ${renderInfoRow('ì›” ìš©ëˆ', student.allowance)}
                                ${renderInfoRow('ìš©ëˆ ì¶œì²˜', student.allowanceSource)}
                            </div>

                            <!-- ì§„ë¡œ ë° ëª©í‘œ (2í˜ì´ì§€ í•­ëª©ì´ì—ˆì§€ë§Œ 1ë‹¨ì— ë°°ì¹˜) -->
                            <div class="border border-gray-300 p-2 break-inside-avoid">
                                <h3 class="font-bold text-sm bg-indigo-100 px-2 py-1 mb-1">ğŸ¯ ì§„ë¡œ ë° ëª©í‘œ</h3>
                                ${renderInfoRow('ì§„ë¡œ í¬ë§ ë¶„ì•¼', student.careerField)}
                                ${renderInfoRow('ëŒ€í•™ ì§„í•™ ì—¬ë¶€', student.collegeIntent)}
                                ${renderInfoRow('ëª©í‘œ í•™êµ/í•™ê³¼', student.targetSchool)}
                                ${renderInfoRow('ë†ì–´ì´Œ í•´ë‹¹', student.ruralArea)}
                                ${student.parentOpinion ? `
                                    <div class="mt-1 pt-1 border-t">
                                        <div class="font-semibold text-gray-700 mb-1">ë³´í˜¸ì ì˜ê²¬</div>
                                        <div class="text-gray-600">${student.parentOpinion}</div>
                                    </div>
                                ` : ''}
                                ${student.careerObstacle ? `
                                    <div style="background-color: #fef3c7; padding: 0.25rem; border-radius: 0.25rem; margin-top: 0.25rem;">
                                        <div class="font-semibold text-gray-700 mb-1">ëª©í‘œ ë‹¬ì„± ë°©í•´ ìš”ì¸</div>
                                        <div class="text-gray-600">${student.careerObstacle}</div>
                                    </div>
                                ` : ''}
                            </div>

                        </div>

                        <!-- ì˜¤ë¥¸ìª½ ì—´ -->
                        <div class="space-y-2">
                            <!-- í•™ìŠµ í˜„í™© (break-inside-avoidë¡œ í˜ì´ì§€ ë¶„í•  ë°©ì§€) -->
                            <div class="border border-gray-300 p-2 break-inside-avoid">
                                <h3 class="font-bold text-sm bg-indigo-100 px-2 py-1 mb-1">ğŸ“š í•™ìŠµ í˜„í™©</h3>
                                ${renderInfoRow('ì‚¬êµìœ¡ ì—¬ë¶€', student.academy)}
                                ${renderInfoRow('ì‚¬êµìœ¡ ì¢…ë¥˜', student.academyTypes)}
                                ${renderInfoRow('ìˆ˜ê°• ìš”ì¼', student.academyDays)}
                                ${renderInfoRow('ìˆ˜ê°• ì‹œê°„', student.academyTime)}
                                ${renderInfoRow('ììŠµ ì‹œê°„', student.studyTime)}
                                ${renderInfoRow('ììŠµ ì¥ì†Œ', student.studyPlace)}
                                ${renderInfoRow('í•™ìŠµ ì–´ë ¤ì›€', student.studyDifficulty)}
                                ${renderInfoRow('ìˆ˜ë©´ ì‹œê°„', student.sleepTime)}
                                ${student.achievement ? `
                                    <div class="mt-1 pt-1 border-t">
                                        <div class="font-semibold text-gray-700 mb-1">í•™ì—… ì„±ì·¨ ê²½í—˜</div>
                                        <div class="text-gray-600">${student.achievement}</div>
                                    </div>
                                ` : ''}
                            </div>

                            <!-- êµìš° ê´€ê³„ (break-inside-avoidë¡œ í˜ì´ì§€ ë¶„í•  ë°©ì§€) -->
                            <div class="border border-gray-300 p-2 break-inside-avoid">
                                <h3 class="font-bold text-sm bg-indigo-100 px-2 py-1 mb-1">ğŸ‘¥ êµìš° ê´€ê³„</h3>
                                ${renderInfoRow('ê°™ì€ ë°˜ ì¹œêµ¬', student.classFriends)}
                                ${renderInfoRow('ë‹¤ë¥¸ ë°˜ ì¹œêµ¬', student.otherFriends)}
                                ${student.distanceFriends ? `
                                    <div style="background-color: #fef3c7; padding: 0.25rem; border-radius: 0.25rem; margin-top: 0.25rem;">
                                        <div class="font-semibold text-gray-700 mb-1">ê±°ë¦¬ë‘ê¸° ì›í•˜ëŠ” ì¹œêµ¬</div>
                                        <div class="text-gray-600">${student.distanceFriends}</div>
                                    </div>
                                ` : ''}
                            </div>

                            <!-- ì„±ê²© ë° íŠ¹ì„± (2í˜ì´ì§€ í•­ëª©ì´ì—ˆì§€ë§Œ 2ë‹¨ì— ë°°ì¹˜) -->
                            <div class="border border-gray-300 p-2 break-inside-avoid">
                                <h3 class="font-bold text-sm bg-indigo-100 px-2 py-1 mb-1">ğŸŒŸ ì„±ê²© ë° íŠ¹ì„±</h3>
                                ${renderInfoRow('ì¥ì ê³¼ ë‹¨ì ', student.strengths)}
                                ${renderInfoRow('ê´€ì‹¬ì‚¬/í•´ì†Œë²•', student.interests)}
                                ${renderInfoRow('ê±´ê°• ìƒíƒœ/ë²„ë¦‡', student.health)}
                                ${renderInfoRow('ì„±ê²© ìœ í˜•', student.personality)}
                                ${renderInfoRow('ì¢‹ì•„í•˜ëŠ”/ì‹«ì€ ê³¼ëª©', student.subjects)}
                                ${renderInfoRow('ì¡´ê²½ ì¸ë¬¼ ë° ì´ìœ ', student.roleModel)}
                            </div>

                        </div>
                    </div>
                    
                    <!-- 1ë‹¨ ë ˆì´ì•„ì›ƒ: ìƒˆí•™ë…„ ë‹¤ì§ (ê°€ì¥ ì•„ë˜ì— ë°°ì¹˜) -->
                    <div class="mt-4 space-y-2 text-xs break-inside-avoid">
                        ${student.resolution ? `
                            <div class="border border-indigo-300" style="background-color: #e0e7ff; padding: 0.5rem;">
                                <h3 class="font-bold text-sm px-2 py-1 mb-1" style="background-color: #c7d2fe;">ğŸ’¬ ìƒˆí•™ë…„ ë‹¤ì§ ë° ë°”ë¼ëŠ” ì </h3>
                                <div class="text-xs text-gray-700">${student.resolution}</div>
                            </div>
                        ` : ''}
                    </div>

                    <!-- ê¸°ì¡´ í‘¸í„° (ì‘ì„±ì¼ ì˜ì—­) ì œê±°ë¨ -->
                </div>
            `;
        }

        function renderInfoRow(label, value) {
            if (!value) return '';
            return `
                <div class="grid grid-cols-5 gap-2 text-xs border-b border-gray-200 py-1">
                    <div class="col-span-2 font-semibold text-gray-700">${label}</div>
                    <div class="col-span-3 text-gray-600">${value}</div>
                </div>
            `;
        }

        // ì§€ìˆ˜ ë°±ì˜¤í”„ë¥¼ ì‚¬ìš©í•˜ì—¬ API í˜¸ì¶œì˜ ì•ˆì •ì„±ì„ ë†’ì´ëŠ” í—¬í¼ í•¨ìˆ˜
        async function fetchWithRetry(url, options, maxRetries = 5) {
            for (let i = 0; i < maxRetries; i++) {
                try {
                    const response = await fetch(url, options);
                    // 429 (Too Many Requests)ê°€ ì•„ë‹ˆê³  ì„±ê³µì ì¸ ì‘ë‹µì´ë©´ ë°”ë¡œ ë°˜í™˜
                    if (response.status !== 429 && response.ok) {
                        return response;
                    }
                    // 429 ì´ê±°ë‚˜, ì¼ì‹œì ì¸ ì˜¤ë¥˜ ë°œìƒ ì‹œ ì¬ì‹œë„ (ë§ˆì§€ë§‰ ì‹œë„ ì œì™¸)
                    if (i < maxRetries - 1) {
                        const delay = Math.pow(2, i) * 1000 + Math.random() * 1000;
                        await new Promise(resolve => setTimeout(resolve, delay));
                        continue; // ì¬ì‹œë„
                    }
                    // ì¬ì‹œë„ íšŸìˆ˜ ì´ˆê³¼ ì‹œ ì˜¤ë¥˜ ë°œìƒ
                    const data = await response.json();
                    throw new Error(data.error?.message || `API ìš”ì²­ì´ HTTP ${response.status} ìƒíƒœë¡œ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.`);
                } catch (error) {
                    if (i === maxRetries - 1) {
                        throw error; // ë§ˆì§€ë§‰ ì‹œë„ ì‹¤íŒ¨
                    }
                    const delay = Math.pow(2, i) * 1000 + Math.random() * 1000;
                    await new Promise(resolve => setTimeout(resolve, delay));
                }
            }
        }


        async function analyzeStudent(student) {
            if (!apiKey) {
                console.error('API í‚¤ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                return;
            }

            aiAnalysis[student.id] = { loading: true };
            render();

            try {
                // í”„ë¡¬í”„íŠ¸ ê°•í™”: ë” ëª…ì‹œì ìœ¼ë¡œ ì‘ë‹µ í˜•ì‹ê³¼ ê¸¸ì´ë¥¼ ì§€ì •í–ˆìŠµë‹ˆë‹¤.
                const prompt = `ë‹¹ì‹ ì€ ê²½í—˜ì´ í’ë¶€í•œ ì¤‘ë“±êµìœ¡ ì „ë¬¸ êµì‚¬ì…ë‹ˆë‹¤. ë‹¤ìŒ í•™ìƒì˜ ê¸°ì´ˆ ìƒë‹´ ìë£Œë¥¼ ë¶„ì„í•˜ì—¬, í•™ìƒ ìƒë‹´ ì‹œ êµì‚¬ê°€ ì§‘ì¤‘í•´ì•¼ í•  **í•µì‹¬ì ì¸ êµìœ¡ì  ì¢…í•© ì˜ê²¬**ì„ **ìµœëŒ€ 5ì¤„ ì´ë‚´**ë¡œ ì‘ì„±í•´ì£¼ì„¸ìš”.
**ì£¼ì˜:** ì„œë¡ ì´ë‚˜ ê²°ë¡  ì—†ì´ **ë°”ë¡œ ë³¸ë¡ (ê°•ì , ì£¼ì˜ì , ì§€ë„ ë°©í–¥)**ë¶€í„° ì‹œì‘í•˜ì—¬ ëª…ë£Œí•˜ê²Œ ì‘ì„±í•´ì•¼ í•©ë‹ˆë‹¤.

--- í•™ìƒ ì •ë³´ ë° ìë£Œ ìš”ì•½ ---
- ì´ë¦„: ${student.name}
- í•™ë²ˆ: ${student.studentId}
- ê°€ì • í™˜ê²½ ë° ê´€ê³„ ì˜ê²¬: ${student.familyComment}
- í•™ìŠµ ì‹œ ì–´ë ¤ìš´ ì  ë° ì„±ì·¨ ê²½í—˜: ${student.studyDifficulty} / ${student.achievement}
- ì£¼ìš” ê´€ì‹¬ì‚¬ ë° ìŠ¤íŠ¸ë ˆìŠ¤ í•´ì†Œë²•: ${student.interests}
- ëª©í‘œ ë‹¬ì„± ë°©í•´ ìš”ì¸: ${student.careerObstacle}
- ì¥ì ê³¼ ë‹¨ì : ${student.strengths}
---
`;

                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
                
                const options = {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: prompt
                            }]
                        }],
                        generationConfig: {
                            temperature: 0.7,
                            maxOutputTokens: 2000 // **í† í° ì œí•œì„ 2000ìœ¼ë¡œ ì¦ê°€**
                        }
                    })
                };

                const response = await fetchWithRetry(apiUrl, options);
                const data = await response.json();
                
                // ë””ë²„ê¹…: API ì‘ë‹µì˜ ì›ì‹œ ë°ì´í„°ë¥¼ ì½˜ì†”ì— ì¶œë ¥í•©ë‹ˆë‹¤.
                console.log('Gemini API Raw Response Data (Check F12 Console):', data);

                // 1. HTTP ìƒíƒœ ì½”ë“œ í™•ì¸ (ì‘ë‹µì´ ì„±ê³µì ì´ì—ˆëŠ”ì§€)
                if (!response.ok) {
                    console.error('API ì‘ë‹µ ì˜¤ë¥˜ ìƒì„¸:', data);
                    throw new Error(data.error?.message || `API ìš”ì²­ì´ HTTP ${response.status} ìƒíƒœë¡œ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.`);
                }

                const candidate = data.candidates?.[0];
                const contentText = candidate?.content?.parts?.[0]?.text;
                const finishReason = candidate?.finishReason;


                // 2. ì•ˆì „ í•„í„°ë§ì— ì˜í•´ ì‘ë‹µì´ ì°¨ë‹¨ë˜ì—ˆëŠ”ì§€ í™•ì¸
                if (finishReason === 'SAFETY') {
                    console.error('ì½˜í…ì¸  ì°¨ë‹¨ ìƒì„¸:', candidate.safetyRatings);
                    throw new Error(`ì•ˆì „ í•„í„°ì— ì˜í•´ ë¶„ì„ ë‚´ìš© ì „ì²´ê°€ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤. (í”„ë¡¬í”„íŠ¸ ë˜ëŠ” í•™ìƒ ë°ì´í„° í™•ì¸ í•„ìš”)`);
                }
                
                // 3. í…ìŠ¤íŠ¸ ì½˜í…ì¸ ê°€ ë¹„ì–´ìˆëŠ” ê²½ìš° (ë¹„ì •ìƒ ì¢…ë£Œ ìƒì„¸ ì²˜ë¦¬)
                if (!contentText) {
                    let errorMessage = 'API ì‘ë‹µì— ì˜ˆìƒë˜ëŠ” í…ìŠ¤íŠ¸ ì½˜í…ì¸ (text field)ê°€ ì—†ìŠµë‹ˆë‹¤.';
                    
                    if (finishReason === 'MAX_TOKENS') {
                        // MAX_TOKENSë¡œ ì¸í•´ í…ìŠ¤íŠ¸ê°€ ì˜ë ¸ìœ¼ë‚˜, ìµœì¢…ì ìœ¼ë¡œ ë¹ˆ ë¬¸ìì—´ì´ ë‚˜ì˜¨ ê²½ìš°
                         errorMessage += `\nëª¨ë¸ì´ ìµœëŒ€ í† í° ì œí•œ(MAX_TOKENS) ë‚´ì—ì„œ ì‘ë‹µì„ ì™„ë£Œí•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. (í† í° ì œí•œì„ 2000ìœ¼ë¡œ ëŠ˜ë ¸ìŒì—ë„ ë°œìƒ)`;
                    } else if (finishReason && finishReason !== 'STOP') {
                        // RECITATION, OTHER ë“± ë¹„ì •ìƒ ì¢…ë£Œ
                        errorMessage += `\nëª¨ë¸ ì‘ë‹µì´ ë¹„ì •ìƒì ìœ¼ë¡œ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ì¢…ë£Œ ì´ìœ : ${finishReason}.`;
                    } else if (finishReason === 'STOP') {
                        // STOPìœ¼ë¡œ ì •ìƒ ì¢…ë£Œí–ˆìœ¼ë‚˜ ë‚´ìš©ì´ ë¹„ì–´ìˆëŠ” ê²½ìš°
                        errorMessage += '\nëª¨ë¸ì´ ì‘ë‹µì„ ì„±ê³µì ìœ¼ë¡œ ì¢…ë£Œí–ˆìœ¼ë‚˜, ë‚´ìš©ì´ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤. ì…ë ¥ ë°ì´í„°ê°€ ë„ˆë¬´ ì§§ê±°ë‚˜ ëª¨ë¸ì´ ì‘ë‹µì„ ìƒì„±í•˜ì§€ ëª»í•œ ê²ƒ ê°™ìŠµë‹ˆë‹¤.';
                    } else {
                        // finishReasonì´ ì—†ê±°ë‚˜, ì˜ˆìƒì¹˜ ëª»í•œ êµ¬ì¡°ì  ì˜¤ë¥˜
                        errorMessage += '\nì‘ë‹µ êµ¬ì¡°ê°€ ì˜ˆìƒê³¼ ë‹¤ë¦…ë‹ˆë‹¤. ì„œë²„ì˜ ì¼ì‹œì  ë¬¸ì œì´ê±°ë‚˜ API í‚¤ ì„¤ì •ì„ ë‹¤ì‹œ í™•ì¸í•´ì£¼ì„¸ìš”.';
                    }

                    console.error('ì˜ëª»ë˜ê±°ë‚˜ ë¹„ì–´ìˆëŠ” ì‘ë‹µ:', data);
                    throw new Error(errorMessage);
                }

                const content = contentText;

                aiAnalysis[student.id] = { 
                    loading: false, 
                    content: content 
                };
                render();

            } catch (error) {
                console.error('AI ë¶„ì„ ì˜¤ë¥˜ ìƒì„¸:', error);
                aiAnalysis[student.id] = { 
                    loading: false, 
                    content: `ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\n\nì˜¤ë¥˜ ë‚´ìš©: ${error.message}\n\nF12ë¥¼ ëˆŒëŸ¬ Console íƒ­ì„ í™•ì¸í•˜ì—¬ ìƒì„¸ ì •ë³´ë¥¼ íŒŒì•…í•˜ê±°ë‚˜, API í‚¤ ë° í• ë‹¹ëŸ‰ì— ë¬¸ì œê°€ ì—†ëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.` 
                };
                render();
            }
        }

        function attachEventListeners() {
            const fileInput = document.getElementById('fileInput');
            if (fileInput) {
                fileInput.addEventListener('change', handleFileUpload);
            }

            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('input', (e) => {
                    searchTerm = e.target.value;
                    render();
                });
            }

            const studentCards = document.querySelectorAll('.student-card');
            studentCards.forEach(card => {
                card.addEventListener('click', () => {
                    const studentId = parseInt(card.dataset.id);
                    selectedStudent = students.find(s => s.id === studentId);
                    currentPage = 'detail';
                    render();
                });
            });

            const backBtn = document.getElementById('backBtn');
            if (backBtn) {
                backBtn.addEventListener('click', () => {
                    currentPage = 'list';
                    selectedStudent = null;
                    render();
                });
            }

            const printBtn = document.getElementById('printBtn');
            if (printBtn) {
                printBtn.addEventListener('click', () => {
                    window.print();
                });
            }

            const printAllBtn = document.getElementById('printAllBtn');
            if (printAllBtn) {
                printAllBtn.addEventListener('click', () => {
                    currentPage = 'printAll';
                    render();
                });
            }

            const saveApiKeyBtn = document.getElementById('saveApiKeyBtn');
            if (saveApiKeyBtn) {
                saveApiKeyBtn.addEventListener('click', () => {
                    const input = document.getElementById('apiKeyInput');
                    apiKey = input.value.trim();
                    localStorage.setItem('geminiApiKey', apiKey);
                    // NOTE: Custom modal usage is required for production, using console.log/simple alert for demo purposes
                    console.log('API í‚¤ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
                });
            }

            const analyzeBtn = document.getElementById('analyzeBtn');
            if (analyzeBtn) {
                analyzeBtn.addEventListener('click', () => {
                    analyzeStudent(selectedStudent);
                });
            }
        }

        async function handleFileUpload(e) {
            const file = e.target.files[0];
            if (!file) return;

            try {
                const data = await file.arrayBuffer();
                const workbook = XLSX.read(data, { type: 'array' });
                const sheetName = workbook.SheetNames[0];
                const worksheet = workbook.Sheets[sheetName];
                const jsonData = XLSX.utils.sheet_to_json(worksheet);

                // ë””ë²„ê¹…: ì»¬ëŸ¼ëª… ì¶œë ¥
                if (jsonData.length > 0) {
                    console.log('ì—‘ì…€ ì»¬ëŸ¼ëª…:', Object.keys(jsonData[0]));
                    console.log('ì²« ë²ˆì§¸ ë°ì´í„°:', jsonData[0]);
                }

                students = jsonData.map((row, index) => ({
                    id: index,
                    timestamp: row['íƒ€ì„ìŠ¤íƒ¬í”„'] || '',
                    studentId: row['í•™ë²ˆ'] || '',
                    name: row['ì´ë¦„'] || '',
                    contact: row['ë³¸ì¸ ì—°ë½ì²˜'] || '',
                    commute: row['ë“±í•˜êµ í•˜ëŠ” ë°©ë²•'] || '',
                    commuteTime: row['ë“±í•˜êµ ì‹œ ê±¸ë¦¬ëŠ” ì‹œê°„'] || '',
                    guardian1Name: row['1. ë³´í˜¸ì ì •ë³´(ì´ë¦„)'] || '',
                    guardian1Relation: row['1-1. ë³´í˜¸ìì™€ì˜ ê´€ê³„'] || '',
                    guardian1Phone: row['1-2. ë³´í˜¸ì ì „í™”ë²ˆí˜¸'] || '',
                    guardian2Name: row['2-1. ì œ 2ë³´í˜¸ì ì„±ëª…'] || '',
                    guardian2Relation: row['2-2. ì œ 2ë³´í˜¸ì ê´€ê³„'] || '',
                    guardian2Phone: row['2-3. ì œ 2ë³´í˜¸ì ì „í™”ë²ˆí˜¸'] || '',
                    siblingId1: row['3-1. ë™ì¼êµ í˜•ì œ ìë§¤ (í•™ë²ˆ)'] || '',
                    siblingName1: row['3-2. ë™ì¼êµ í˜•ì œ ìë§¤ (ì´ë¦„)'] || '',
                    siblingId2: row['4-1. ë™ì¼êµ í˜•ì œ ìë§¤ 2 (í•™ë²ˆ)'] || '',
                    siblingName2: row['4-2. ë™ì¼êµ í˜•ì œ ìë§¤ 2 (ì´ë¦„)'] || '',
                    familyMembers: row['5. í˜„ì¬ í•¨ê»˜ ìƒí™œí•˜ëŠ” ì‚¬ëŒì„ ì ì–´ì£¼ì„¸ìš”'] || '',
                    familyIntimacy: row['5-1. ê°€ì¡± êµ¬ì„±ì›ê³¼ì˜ ì¹œë°€ë„'] || '',
                    familyComment: row['5-2. ê°€ì •ë‚´ì˜ ê´€ê³„ì— ëŒ€í•´ í•˜ê³  ì‹¶ì€ ë§'] || '',
                    scholarship: row['6. ì¥í•™ê¸ˆ í˜œíƒ'] || '',
                    scholarshipReason: row['6-1. ì¥í•™ê¸ˆì´ í•„ìš”í•œ ì´ìœ  ì„¤ëª…'] || '',
                    allowance: row['7-1. í•œë‹¬ì— ìš©ëˆì€ ì–¼ë§ˆë‚˜ ì“°ë‚˜ìš”?'] || '',
                    allowanceSource: row['7-2. ìš©ëˆì€ ì£¼ë¡œ ì–´ë–»ê²Œ, ì–¼ë§ˆë‚˜ ì–»ë‚˜ìš”?'] || '',
                    academy: row['8. í•™ì› ë° ê¸°íƒ€ ì‚¬êµìœ¡ì„ ë°›ê³  ìˆë‚˜ìš”?'] || '',
                    academyTypes: row['8-1. í•™ì› ë° ê¸°íƒ€ ì‚¬êµìœ¡ì˜ ì¢…ë¥˜'] || '',
                    academyDays: row['8-2. í•™ì›ì— ë‹¤ë‹ˆëŠ” ìš”ì¼(ëª¨ë‘ ì„ íƒ)'] || '',
                    academyTime: row['8-3. í•™ì› ìˆ˜ê°• ì‹œê°„ì„ ì•Œë ¤ì£¼ì„¸ìš”'] || '',
                    studyTime: row['9. ìŠ¤ìŠ¤ë¡œ ìê¸°ì£¼ë„ì  í•™ìŠµí•˜ëŠ” ì‹œê°„ì€ ì–¼ë§ˆë‚˜ ë˜ë‚˜ìš”?'] || '',
                    studyPlace: row['9-1. ìŠ¤ìŠ¤ë¡œ ìê¸°ì£¼ë„ í•™ìŠµí•˜ëŠ” ê³µê°„ì€ ì–´ë””ì¸ê°€ìš”?'] || '',
                    studyDifficulty: row['9-2. ìê¸°ì£¼ë„ í•™ìŠµ ì‹œ ì–´ë ¤ìš´ ì ì€?'] || '',
                    achievement: row['9-3. í•™ì—… ì„±ì·¨ë¥¼ ì´ë£¬ ê²½í—˜ì„ ì†Œê°œí•´ì£¼ì„¸ìš”.'] || '',
                    sleepTime: row['9-4. ì¼ë°˜ì ìœ¼ë¡œ ëª‡ì‹œë¶€í„° ëª‡ì‹œê¹Œì§€ ìë‚˜ìš”?'] || '',
                    classFriends: row['10-1. ìš°ë¦¬ë°˜ì—ì„œ ì¹œí•œ ì¹œêµ¬ëŠ” ëˆ„êµ¬ì¸ê°€ìš”?'] || '',
                    otherFriends: row['10-2. ë‹¤ë¥¸ ë°˜ì—ì„œ ì¹œí•œ ì¹œêµ¬ëŠ” ëˆ„êµ¬ì¸ê°€ìš”?'] || '',
                    distanceFriends: row['10-3. ìš°ë¦¬ ë°˜ì—ì„œ ë§ˆìŒì— ê±°ë¦¬ë¥¼ ë‘ê³  ì‹¶ì€ ì¹œêµ¬ê°€ ìˆë‚˜ìš”?'] || '',
                    careerField: row['11-1. ì§„ë¡œ í¬ë§ ë¶„ì•¼(ì¥ë˜ í¬ë§)'] || '',
                    collegeIntent: row['11-2. ëŒ€í•™ ì§„í•™ ì—¬ë¶€'] || '',
                    ruralArea: row['11-3. ë†ì–´ì´Œ í•´ë‹¹ ì—¬ë¶€'] || '',
                    parentOpinion: row['11-4. ìì‹ ì˜ ì§„ë¡œì™€ ê´€ë ¨ëœ ë³´í˜¸ìì˜ ì˜ê²¬ì€?'] || '',
                    careerObstacle: row['12. ë‚˜ì˜ ëª©í‘œ ë‹¬ì„±ê³¼ ê´€ë ¨í•œ ê°€ì¥ í° ë°©í•´ìš”ì¸ì€?'] || '',
                    strengths: row['13. ë‚˜ì˜ ì¥ì ê³¼ ë‹¨ì (íŠ¹ê¸° í¬í•¨)'] || '',
                    interests: row['14. ì£¼ìš” ê´€ì‹¬ì‚¬ ë° ìŠ¤íŠ¸ë ˆìŠ¤ë¥¼ í•´ì†Œí•˜ê¸° ìœ„í•œ ë‚˜ë§Œì˜ ë°©ë²•ì€?'] || '',
                    health: row['15. ë³¸ì¸ì˜ ê±´ê°• ìƒíƒœ ë° ë²„ë¦‡(ì„±ê²©)'] || '',
                    personality: row['16. ìì‹ ì˜ ì„±ê²©ì€ ì–´ë–¤ ì„±ê²©ì¸ê²ƒ ê°™ë‚˜ìš”?'] || '',
                    subjects: row['17. ì¢‹ì•„í•˜ëŠ” ê³¼ëª©ê³¼ ì‹«ì–´í•˜ëŠ” ê³¼ëª©ì€?'] || '',
                    roleModel: row['18. ì¡´ê²½í•˜ëŠ” ì¸ë¬¼ì€? ê·¸ ì´ìœ ëŠ”?'] || '',
                    resolution: row['19. ìƒˆí•™ë…„ ë‹¤ì§ê³¼ ì•ìœ¼ë¡œ ì„ ìƒë‹˜ì—ê²Œ ë°”ë¼ëŠ” ì , í•˜ê³ ì‹¶ì€ ë§'] || ''
                }));

                render();
            } catch (err) {
                const errorDiv = document.getElementById('error');
                if (errorDiv) {
                    errorDiv.textContent = 'íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì˜¬ë°”ë¥¸ ì—‘ì…€ íŒŒì¼ì¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.';
                    errorDiv.classList.remove('hidden');
                }
                console.error(err);
            }
        }

        // ì´ˆê¸° ë Œë”ë§
        render();
    </script>
</body>
</html>